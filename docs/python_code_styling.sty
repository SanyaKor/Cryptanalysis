\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{py_listing}[2025/06/01 Python listing preset with layout]

\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}
\RequirePackage{geometry}
\geometry{margin=2.5cm}

\RequirePackage{xcolor}
\RequirePackage{listings}
\definecolor{codebg}{rgb}{0.97,0.97,0.97}
\definecolor{keywordcolor}{rgb}{0.36,0.15,0.80}
\definecolor{builtincolor}{rgb}{0.20,0.40,0.80}
\definecolor{exceptioncolor}{rgb}{0.65,0.15,0.15}
\definecolor{typecolor}{rgb}{0.10,0.50,0.60}
\definecolor{stringcolor}{rgb}{0.19,0.54,0.33}
\definecolor{commentcolor}{rgb}{0.50,0.50,0.50}
\definecolor{numbercolor}{rgb}{0.40,0.40,0.40}
\definecolor{identifiercolor}{rgb}{0.10,0.10,0.10}
\definecolor{constcolor}{rgb}{0.80,0.10,0.50}

% === Enhanced Python language definition ===
\lstdefinelanguage{EnhancedPython}{
    keywords={
        def, return, if, elif, else, while, for, in, import, from, as,
        pass, raise, break, continue, and, or, not, is, lambda, with,
        try, except, finally, class, yield, assert
    },
    keywordstyle=\color{keywordcolor}\bfseries,
    ndkeywords={
        self
    },
    ndkeywordstyle=\color{identifiercolor}\bfseries,
    identifierstyle=\color{identifiercolor},
    sensitive=true,
    comment=[l]{\#},
    commentstyle=\color{commentcolor}\ttfamily,
    stringstyle=\color{stringcolor},
    morestring=[b]',
    morestring=[b]",
    alsoletter={.},
    morekeywords=[2]{print, len, range, open, isinstance, input, type, map, zip, filter, sum},
    keywordstyle=[2]\color{builtincolor}\bfseries,
    morekeywords=[3]{ValueError, Exception, TypeError, OSError, RuntimeError},
    keywordstyle=[3]\color{exceptioncolor}\bfseries,
    morekeywords=[4]{int, str, float, bool, list, dict, set, tuple, object},
    keywordstyle=[4]\color{typecolor},
    morekeywords=[5]{None, True, False},
    keywordstyle=[5]\color{constcolor}\bfseries
}

% === Global Style Settings ===
\lstset{
    language=EnhancedPython,
    backgroundcolor=\color{codebg},
    basicstyle=\footnotesize\ttfamily,
    numbers=left,
    numberstyle=\tiny\color{numbercolor},
    stepnumber=1,
    numbersep=10pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    frame=single,
    rulecolor=\color{black},
    tabsize=4,
    captionpos=b,
    breaklines=true,
    breakatwhitespace=false,
    escapeinside={\%*}{*)}
}
